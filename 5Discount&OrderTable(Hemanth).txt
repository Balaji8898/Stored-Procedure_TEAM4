--Discount Table

--------------
--DISCOUNT TABLE 
CREATE TABLE tbl_DISCOUNT (DISCOUNT_ID INT PRIMARY KEY, DISCOUNT_VALUE INT, COUPON_CODE VARCHAR(20),VALID_TILL DATETIME)          

CREATE SEQUENCE seq_DISCOUNT_ID AS INT START WITH 1 INCREMENT BY 1;

 

INSERT INTO tbl_DISCOUNT VALUES(NEXT VALUE FOR seq_DISCOUNT_ID, 100,'ZAPCAXTY','2021-09-01');
INSERT INTO tbl_DISCOUNT VALUES(NEXT VALUE FOR seq_DISCOUNT_ID, 100,'ZAPCAXTY','2021-09-01');
INSERT INTO tbl_DISCOUNT VALUES(NEXT VALUE FOR seq_DISCOUNT_ID, 100,'ZAPCAXTY','2021-09-01');
INSERT INTO tbl_DISCOUNT VALUES(NEXT VALUE FOR seq_DISCOUNT_ID, 100,'ZAPCAXTY','2021-09-01');
INSERT INTO tbl_DISCOUNT VALUES(NEXT VALUE FOR seq_DISCOUNT_ID, 100,'ZAPCAXTY','2021-09-01');

 

 

SELECT*FROM tbl_DISCOUNT

------------------
--STORED PROCEDURE
------------------

 


--PROCEDURE TO INSERT

GO
CREATE PROCEDURE SP_DISCOUNT_INSERT
@DISCOUNT_VALUE INT,
@COUPON_CODE VARCHAR(20),
@VALID_TILL DATETIME

 


AS
BEGIN
INSERT INTO
tbl_DISCOUNT (DISCOUNT_ID,DISCOUNT_VALUE,COUPON_CODE, VALID_TILL)
VALUES(NEXT VALUE FOR seq_DISCOUNT_ID,@DISCOUNT_VALUE,@COUPON_CODE, @VALID_TILL)
END

 

------------
--------------
------------
--STORED_PROCEDURE FOR UPDATING DISCOUNTS
DROP PROCEDURE SP_DISCOUNT_UPDATE
GO
CREATE PROCEDURE SP_DISCOUNT_UPDATE
@DISCOUNT_ID INT,
@DISCOUNT_VALUE INT,
@COUPON_CODE VARCHAR, 
@VALID_TILL DATETIME

 

AS
BEGIN
UPDATE tbl_DISCOUNT SET DISCOUNT_VALUE=@DISCOUNT_VALUE,COUPON_CODE=@COUPON_CODE ,VALID_TILL=@VALID_TILL WHERE DISCOUNT_ID =@DISCOUNT_ID
END;

 

--STORED_PROCEDURE FOR DISPLAY DISCOUNTS
GO
CREATE PROCEDURE SP_DISPLAY_DISCOUNT
@DISCOUNT_ID INT
AS
BEGIN
SELECT*FROM tbl_DISCOUNT WHERE DISCOUNT_ID = @DISCOUNT_ID
END
----------------------------------------------------------------------------------------------------------------------

--Order Table
--CREATING ORDER TABLE

CREATE TABLE tbl_ORDERS (ORDER_ID INT PRIMARY KEY, USER_ID INT NOT NULL, ORDER_DATE DATETIME NOT NULL , MENU_ID INT, TOTAL_AMOUNT FLOAT,DISCOUNT_ID INT, DISCOUNTED_AMOUNT INT, PAID_AMOUNT INT, FOREIGN KEY(USER_ID) REFERENCES tbl_USER (USER_ID),FOREIGN KEY(MENU_ID) REFERENCES tbl_MENU (MENU_ID),FOREIGN KEY(DISCOUNT_ID) REFERENCES tbl_DISCOUNT (DISCOUNT_ID)  ,CREATED_DATE DATETIME,LAST_MODIFIED DATETIME)

--CREATE SEQUENCE FOR ORDER_ID--


CREATE SEQUENCE seq_ORDER_ID AS INT START WITH 1 INCREMENT BY 1;


INSERT INTO tbl_ORDERS VALUES(NEXT VALUE FOR seq_ORDER_ID, 1001,GETDATE(),1, 1000,1,90,900,GETDATE(),GETDATE());
INSERT INTO tbl_ORDERS VALUES(NEXT VALUE FOR seq_ORDER_ID, 1002,GETDATE(),2, 1500,2,100,1400,GETDATE(),GETDATE());
INSERT INTO tbl_ORDERS VALUES(NEXT VALUE FOR seq_ORDER_ID, 1003,GETDATE(),3, 1000,3,90,900,GETDATE(),GETDATE());
INSERT INTO tbl_ORDERS VALUES(NEXT VALUE FOR seq_ORDER_ID, 1004,GETDATE(),4, 1000,4,90,900,GETDATE(),GETDATE());
INSERT INTO tbl_ORDERS VALUES(NEXT VALUE FOR seq_ORDER_ID, 1005,GETDATE(),5, 1000,5,90,900,GETDATE(),GETDATE());

 

SELECT * FROM tbl_ORDERS


--PROCEDURE TO INSERT

GO
CREATE PROCEDURE SP_INSERT_ORDERS

 

@ORDER_ID INT,  
@USER_ID INT,   
@MENU_ID INT,
@TOTAL_AMOUNT FLOAT, 
@DISCOUNTED_AMOUNT INT, 
@PAID_AMOUNT INT 
AS
BEGIN
INSERT INTO
tbl_ORDERS (ORDER_ID, USER_ID, ORDER_DATE, MENU_ID, TOTAL_AMOUNT, DISCOUNTED_AMOUNT, PAID_AMOUNT , CREATED_DATE )
VALUES(@ORDER_ID,@USER_ID ,GETDATE(),@MENU_ID,@TOTAL_AMOUNT,@DISCOUNTED_AMOUNT,@PAID_AMOUNT,GETDATE())
END

 

 


--STORED_PROCEDURE FOR UPDATING ORDERS
GO
CREATE PROCEDURE SP_UPDATE_ORDER
@ORDER_ID INT,
@TOTAL_AMOUNT FLOAT, 
@DISCOUNTED_AMOUNT INT, 
@PAID_AMOUNT INT 

 

AS
BEGIN
UPDATE tbl_ORDERS  SET TOTAL_AMOUNT=@TOTAL_AMOUNT, DISCOUNTED_AMOUNT=@DISCOUNTED_AMOUNT,LAST_MODIFIED=GETDATE() WHERE ORDER_ID =@ORDER_ID;
END;

 

 


--PROCEDURE TO DISPLAY
GO
CREATE PROCEDURE SP_DISPLAY_ORDER
@ORDER_ID INT
AS
BEGIN
SELECT * FROM tbl_ORDERS WHERE ORDER_ID=@ORDER_ID
END

 


SELECT * FROM tbl_ORDERS
